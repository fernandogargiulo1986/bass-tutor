<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generatore Esercizi Basso</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
            /* Miglioramento stilistico: gradiente di sfondo sottile */
            background-color: #030712; /* gray-950 */
            background-image: radial-gradient(circle at top, #1f2937, #030712 50%);
        }
        .btn-press:active {
            transform: scale(0.98);
            filter: brightness(0.95);
        }
        /* Stile per i lucchetti di blocco */
        .lock-btn {
            transition: color 0.2s ease-in-out, transform 0.2s ease-in-out;
            cursor: pointer;
        }
        .lock-btn:hover {
            transform: scale(1.1);
        }
        .lock-btn.locked {
            color: #2dd4bf; /* Teal-400 */
        }
        /* Stile per l'input del tempo */
        .tempo-input {
            background-color: transparent;
            border: none;
            width: 100%;
            color: white;
            font-size: 1.5rem; /* text-2xl */
            line-height: 2rem;
            font-weight: 600; /* font-semibold */
            transition: background-color 0.2s ease;
        }
        .tempo-input:focus {
            outline: none;
            background-color: #374151; /* gray-700 */
            border-radius: 4px;
        }
        /* Stili per i checkbox custom */
        .key-checkbox {
            -webkit-appearance: none;
            appearance: none;
            background-color: #374151;
            margin-right: 0.5rem;
            color: currentColor;
            width: 1.15em;
            height: 1.15em;
            border: 0.1em solid #4b5563;
            border-radius: 0.25em;
            transform: translateY(-0.075em);
            display: grid;
            place-content: center;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }
        .key-checkbox:hover {
            border-color: #6b7280;
        }
        .key-checkbox::before {
            content: "";
            width: 0.65em;
            height: 0.65em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em #2dd4bf;
            transform-origin: bottom left;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        .key-checkbox:checked::before {
            transform: scale(1);
        }
        /* Miglioramento stilistico: effetto "lift" sulle card */
        .result-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }
        .result-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-color: #2dd4bf; /* Teal-400 */
        }
        /* Miglioramento stilistico: transizione fade-in per il testo */
        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl text-center">
        <header class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-teal-400">Generatore di Esercizi</h1>
            <p class="text-lg text-gray-400">per Basso Elettrico</p>
        </header>

        <main>
            <!-- Sezione Impostazioni -->
            <div id="settings-panel" class="bg-gray-800/50 backdrop-blur-sm p-6 rounded-lg border border-gray-700 mb-8 text-left">
                <h2 class="text-xl font-bold text-white mb-4">Impostazioni</h2>
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-sm font-bold text-teal-400 uppercase tracking-wider">TonalitÃ  disponibili</h3>
                        <div class="flex space-x-2">
                            <!-- Miglioramento stilistico: bottoni piÃ¹ puliti -->
                            <button id="selectAllKeysBtn" class="text-xs border border-gray-600 hover:bg-gray-700 hover:border-gray-500 text-gray-300 py-1 px-3 rounded-md transition-colors">Tutte</button>
                            <button id="deselectAllKeysBtn" class="text-xs border border-gray-600 hover:bg-gray-700 hover:border-gray-500 text-gray-300 py-1 px-3 rounded-md transition-colors">Nessuna</button>
                        </div>
                    </div>
                    <div id="key-selection-container" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2">
                        <!-- Le checkbox delle tonalitÃ  verranno inserite qui da JS -->
                    </div>
                </div>
            </div>

            <!-- Pulsante per generare l'esercizio -->
            <button id="generateBtn" class="bg-teal-500 hover:bg-teal-600 text-gray-900 font-bold py-4 px-8 rounded-xl text-xl shadow-lg shadow-teal-500/20 transition-all duration-200 ease-in-out btn-press mb-8 w-full md:w-auto">
                Genera Nuovo Esercizio
            </button>

            <!-- Contenitore per i risultati dell'esercizio -->
            <div id="exercise-output" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-left">
                <!-- TonalitÃ  -->
                <div class="result-card bg-gray-800/50 backdrop-blur-sm p-6 rounded-lg border border-gray-700">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-sm font-bold text-teal-400 uppercase tracking-wider">TonalitÃ </h2>
                        <span class="lock-btn text-gray-500 text-xl" data-part="key" title="Blocca TonalitÃ ">ðŸ”’</span>
                    </div>
                    <p id="key" class="text-2xl font-semibold text-white">-</p>
                </div>
                <!-- Tempo -->
                <div class="result-card bg-gray-800/50 backdrop-blur-sm p-6 rounded-lg border border-gray-700">
                    <div class="flex justify-between items-center mb-2">
                         <h2 class="text-sm font-bold text-teal-400 uppercase tracking-wider">Tempo (BPM)</h2>
                         <span class="lock-btn text-gray-500 text-xl" data-part="tempo" title="Blocca Tempo">ðŸ”’</span>
                    </div>
                    <input type="number" id="tempo" class="tempo-input" min="40" max="240">
                </div>
                 <!-- Pattern 1 -->
                <div class="result-card bg-gray-800/50 backdrop-blur-sm p-6 rounded-lg border border-gray-700">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-sm font-bold text-teal-400 uppercase tracking-wider">Pattern 1</h2>
                        <span class="lock-btn text-gray-500 text-xl" data-part="part1" title="Blocca Pattern 1">ðŸ”’</span>
                    </div>
                    <p id="part1" class="text-2xl font-semibold text-white">-</p>
                </div>
                <!-- Ritmo 1 -->
                <div class="result-card bg-gray-800/50 backdrop-blur-sm p-6 rounded-lg border border-gray-700">
                     <div class="flex justify-between items-center mb-2">
                        <h2 class="text-sm font-bold text-teal-400 uppercase tracking-wider">Ritmo Pattern 1</h2>
                        <span class="lock-btn text-gray-500 text-xl" data-part="part3" title="Blocca Ritmo 1">ðŸ”’</span>
                    </div>
                    <p id="part3" class="text-2xl font-semibold text-white">-</p>
                </div>
                <!-- Pattern 2 -->
                <div class="result-card bg-gray-800/50 backdrop-blur-sm p-6 rounded-lg border border-gray-700">
                     <div class="flex justify-between items-center mb-2">
                        <h2 class="text-sm font-bold text-teal-400 uppercase tracking-wider">Pattern 2</h2>
                        <span class="lock-btn text-gray-500 text-xl" data-part="part2" title="Blocca Pattern 2">ðŸ”’</span>
                    </div>
                    <p id="part2" class="text-2xl font-semibold text-white">-</p>
                </div>
                <!-- Ritmo 2 -->
                <div class="result-card bg-gray-800/50 backdrop-blur-sm p-6 rounded-lg border border-gray-700">
                     <div class="flex justify-between items-center mb-2">
                        <h2 class="text-sm font-bold text-teal-400 uppercase tracking-wider">Ritmo Pattern 2</h2>
                        <span class="lock-btn text-gray-500 text-xl" data-part="part4" title="Blocca Ritmo 2">ðŸ”’</span>
                    </div>
                    <p id="part4" class="text-2xl font-semibold text-white">-</p>
                </div>
            </div>
        </main>
        
        <footer class="mt-12 text-gray-500 text-sm">
            <p>Creato per il tuo studio quotidiano.</p>
        </footer>
    </div>

    <script>
        // --- ELEMENTI DEL DOM ---
        const generateBtn = document.getElementById('generateBtn');
        const keyEl = document.getElementById('key');
        const tempoEl = document.getElementById('tempo');
        const part1El = document.getElementById('part1');
        const part2El = document.getElementById('part2');
        const part3El = document.getElementById('part3');
        const part4El = document.getElementById('part4');
        const keySelectionContainer = document.getElementById('key-selection-container');
        const selectAllKeysBtn = document.getElementById('selectAllKeysBtn');
        const deselectAllKeysBtn = document.getElementById('deselectAllKeysBtn');

        // --- STATO DELL'APPLICAZIONE (per i lucchetti) ---
        let state = {
            key: { locked: false, value: null, type: null },
            tempo: { locked: false, value: null, type: null },
            part1: { locked: false, value: null, type: null },
            part2: { locked: false, value: null, type: null },
            part3: { locked: false, value: null, type: null },
            part4: { locked: false, value: null, type: null }
        };

        // --- DATI PER LA GENERAZIONE ---
        const data = {
            tonalita: ['Do', 'Sol', 'Re', 'La', 'Mi', 'Si', 'Faâ™¯', 'Doâ™¯', 'Fa', 'Siâ™­', 'Miâ™­', 'Laâ™­'],
            // qualita: ['Maggiore', 'Minore Naturale', 'Minore Armonica', 'Pentatonica Maggiore'], // Lasciato per futura implementazione
            tipologie: [
                { 
                    nome: 'Arpeggio', 
                    ritmi: ['Semiminime', 'Minima + Crome', 'Crome + Minima', '3/4 + terzina', 'terzina + 3/4', 'due crome, minima e semiminima'] 
                },
                { 
                    nome: 'Scala', 
                    ritmi: ['Crome', 'Semiminima + Terzina (2X)', 'Terzina + Semiminima (2X)', 'Terzina + due semiminime + terzina', 'Semiminima + 2 terzine + semiminima', '4 crome + semiminima + tezina', 'Semiminima + terzina + 4 crome'] 
                }
            ],
            direzioni: ['Ascendente', 'Discendente']
        };

        // --- FUNZIONI ---
        
        /**
         * Restituisce un elemento casuale da un array.
         */
        function getRandomElement(arr) {
            if (arr.length === 0) return null;
            return arr[Math.floor(Math.random() * arr.length)];
        }

        /**
         * Popola il contenitore con le checkbox per la selezione delle tonalitÃ .
         */
        function populateKeySelection() {
            data.tonalita.forEach(key => {
                const wrapper = document.createElement('div');
                wrapper.className = 'flex items-center';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `key-${key}`;
                checkbox.value = key;
                checkbox.checked = true;
                checkbox.className = 'key-checkbox';

                const label = document.createElement('label');
                label.htmlFor = `key-${key}`;
                label.textContent = key;
                label.className = 'text-white cursor-pointer';

                wrapper.appendChild(checkbox);
                wrapper.appendChild(label);
                keySelectionContainer.appendChild(wrapper);
            });
        }
        
        /**
         * Seleziona o deseleziona tutte le checkbox delle tonalitÃ .
         * @param {boolean} isSelected True per selezionare, false per deselezionare.
         */
        function setAllKeys(isSelected) {
            keySelectionContainer.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = isSelected;
            });
        }

        /**
         * Gestisce il click su un pulsante di blocco (lucchetto).
         * @param {Event} e L'evento del click.
         */
        function toggleLock(e) {
            const part = e.target.dataset.part;
            if (!part) return;

            state[part].locked = !state[part].locked;
            e.target.classList.toggle('locked', state[part].locked);
            
            if (part === 'tempo' && state.tempo.locked) {
                 state.tempo.value = tempoEl.value;
            }
        }
        
        /**
         * Aggiorna il testo di un elemento con un effetto fade-in.
         * @param {HTMLElement} element L'elemento da aggiornare.
         * @param {string} text Il nuovo testo.
         */
        function updateTextWithFade(element, text) {
            if (element.textContent === text) return; // Non fare nulla se il testo Ã¨ identico
            element.classList.remove('fade-in');
            // Questo trucco forza il browser a rieseguire l'animazione
            void element.offsetWidth; 
            element.textContent = text;
            element.classList.add('fade-in');
        }

        /**
         * Genera e visualizza un nuovo esercizio completo.
         */
        function generateExercise() {
            // --- TONALITÃ€ ---
            if (!state.key.locked) {
                const selectedKeys = Array.from(keySelectionContainer.querySelectorAll('input:checked')).map(cb => cb.value);
                const sourceKeys = selectedKeys.length > 0 ? selectedKeys : data.tonalita;
                state.key.value = getRandomElement(sourceKeys) || 'Nessuna';
            }

            // --- TEMPO ---
            if (!state.tempo.locked) {
                state.tempo.value = Math.round((Math.random() * (160 - 60) + 60) / 5) * 5;
            }

            // --- PATTERN 1 ---
            if (!state.part1.locked) {
                const tipo = getRandomElement(data.tipologie);
                const direzione = getRandomElement(data.direzioni);
                state.part1.value = `${tipo.nome} ${direzione}`;
                state.part1.type = tipo;
            }

            // --- PATTERN 2 (diverso dal primo se possibile) ---
            if (!state.part2.locked) {
                const tipiFiltrati = data.tipologie.filter(t => t.nome !== state.part1.type.nome);
                const tipo = tipiFiltrati.length > 0 ? getRandomElement(tipiFiltrati) : getRandomElement(data.tipologie);
                const direzione = getRandomElement(data.direzioni);
                state.part2.value = `${tipo.nome} ${direzione}`;
                state.part2.type = tipo;
            }

            // --- RITMO 1 ---
            if (!state.part3.locked) {
                state.part3.value = getRandomElement(state.part1.type.ritmi);
            }

            // --- RITMO 2 ---
            if (!state.part4.locked) {
                 state.part4.value = getRandomElement(state.part2.type.ritmi);
            }
            
            // --- AGGIORNAMENTO INTERFACCIA ---
            updateTextWithFade(keyEl, state.key.value);
            if (document.activeElement !== tempoEl) { // Evita di aggiornare mentre l'utente scrive
                tempoEl.value = state.tempo.value;
            }
            updateTextWithFade(part1El, state.part1.value);
            updateTextWithFade(part2El, state.part2.value);
            updateTextWithFade(part3El, state.part3.value);
            updateTextWithFade(part4El, state.part4.value);
        }

        // --- EVENT LISTENERS ---
        generateBtn.addEventListener('click', generateExercise);
        document.querySelectorAll('.lock-btn').forEach(btn => btn.addEventListener('click', toggleLock));
        selectAllKeysBtn.addEventListener('click', () => setAllKeys(true));
        deselectAllKeysBtn.addEventListener('click', () => setAllKeys(false));
        
        // --- INIZIALIZZAZIONE ---
        window.addEventListener('load', () => {
            populateKeySelection();
            generateExercise();
            // Rimuovi l'animazione iniziale dopo il primo caricamento
            setTimeout(() => {
                document.querySelectorAll('.fade-in').forEach(el => el.classList.remove('fade-in'));
            }, 500);
        });

    </script>
</body>
</html>
